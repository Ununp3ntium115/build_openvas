# Comprehensive Vulnerability Scoring System

## ðŸŽ¯ Overview

The AI-Enhanced OpenVAS vulnerability scoring system provides comprehensive risk assessment by integrating multiple industry-standard scoring methodologies with AI-powered analysis. This system goes beyond traditional CVSS scoring to provide contextual, actionable vulnerability prioritization.

## ðŸ“Š Supported Scoring Systems

### 1. CVSS (Common Vulnerability Scoring System)

#### **CVSS v4.0** (Latest - 2023)
- **Status**: Enhanced metrics with refined environmental and threat factors
- **New Features**: 
  - Attack Requirements metric
  - Subsequent System Impact metrics
  - Improved threat metrics
- **Usage**: Most comprehensive scoring when available

#### **CVSS v3.1** (Current Standard - 2019)
- **Metrics**: Base, Temporal, Environmental
- **Score Range**: 0.0 - 10.0
- **Severity Levels**: None (0.0), Low (0.1-3.9), Medium (4.0-6.9), High (7.0-8.9), Critical (9.0-10.0)
- **Usage**: Primary scoring system for most vulnerabilities

#### **CVSS v3.0** (Legacy - 2015)
- **Status**: Superseded by v3.1 but still used in some databases
- **Differences**: Minor refinements in v3.1

#### **CVSS v2** (Deprecated - 2007)
- **Status**: Legacy system, rarely used for new vulnerabilities
- **Score Range**: 0.0 - 10.0
- **Severity Levels**: Low (0.0-3.9), Medium (4.0-6.9), High (7.0-10.0)

### 2. KEV (Known Exploited Vulnerabilities Catalog)

#### **CISA KEV Catalog**
- **Purpose**: Identifies vulnerabilities with confirmed active exploitation
- **Update Frequency**: Daily
- **Impact**: KEV status overrides other scoring for prioritization
- **Data Points**:
  - Date added to catalog
  - Required action due date
  - Remediation requirements
  - Known ransomware campaign usage

#### **KEV Decision Logic**
```
if (vulnerability.is_kev) {
    priority = CRITICAL;
    urgency = IMMEDIATE;
}
```

### 3. EPSS (Exploit Prediction Scoring System)

#### **FIRST.org EPSS**
- **Purpose**: Predicts likelihood of exploitation in next 30 days
- **Score Range**: 0.0 - 1.0 (probability)
- **Model**: Machine learning based on threat intelligence
- **Update Frequency**: Daily
- **Interpretation**:
  - 0.00052 (0.05%) = Very low probability
  - 0.1 (10%) = Moderate probability
  - 0.5 (50%) = High probability

#### **EPSS Integration**
```
composite_risk = (cvss_score * 0.4) + (epss_score * 10 * 0.2) + ...
```

### 4. SSVC (Stakeholder-Specific Vulnerability Categorization)

#### **CISA SSVC Framework**
- **Purpose**: Decision tree for vulnerability prioritization
- **Decisions**: Track, Track*, Attend, Act
- **Factors**:
  - Exploitation status (none/poc/active)
  - Automatable (no/yes)
  - Technical impact (partial/total)
  - Mission/business impact (low/medium/high/very_high)

#### **SSVC Decision Matrix**
| Exploitation | Automatable | Technical Impact | Mission Impact | Decision |
|-------------|-------------|------------------|----------------|----------|
| Active      | Yes         | Total           | High           | Act      |
| Active      | Yes         | Total           | Medium         | Act      |
| POC         | Yes         | Total           | High           | Attend   |
| None        | No          | Partial         | Low            | Track    |

## ðŸ¤– AI-Enhanced Scoring

### Composite Risk Score Calculation

The AI system combines all scoring methodologies using weighted averages:

```c
composite_score = (cvss_score * 0.4) +          // 40% weight
                 (kev_multiplier * 0.3) +        // 30% weight  
                 (epss_score * 10 * 0.2) +       // 20% weight
                 (ssvc_score * 0.1);             // 10% weight
```

### AI Priority Determination

```c
if (kev.is_kev) return "CRITICAL";
if (cvss >= HIGH && epss > 0.1) return "CRITICAL";
if (cvss == CRITICAL) return "HIGH";
if (ssvc == ACT) return "HIGH";
// ... additional logic
```

### Remediation Urgency

- **IMMEDIATE**: KEV vulnerabilities
- **HIGH**: Critical CVSS with medium+ EPSS
- **MEDIUM**: High CVSS or SSVC Attend
- **LOW**: Medium CVSS or SSVC Track

## ðŸ”„ External Data Integration

### Data Sources

1. **NVD (National Vulnerability Database)**
   - Endpoint: `https://services.nvd.nist.gov/rest/json/cves/2.0`
   - Rate Limit: 5 requests per 30 seconds (without API key)
   - Data: CVSS scores, CWE mappings, references

2. **CISA KEV Catalog**
   - Endpoint: `https://www.cisa.gov/sites/default/files/feeds/known_exploited_vulnerabilities.json`
   - Update: Daily
   - Data: KEV status, due dates, required actions

3. **FIRST.org EPSS**
   - Endpoint: `https://api.first.org/data/v1/epss`
   - Rate Limit: Reasonable usage
   - Data: EPSS scores, percentiles, model versions

4. **SSVC Data**
   - Source: Custom implementation or FIRST.org
   - Data: Decision tree results, factor analysis

### Rate Limiting & Caching

```c
// NVD API rate limiting
#define NVD_RATE_LIMIT_DELAY_MS 6000

// EPSS API rate limiting  
#define EPSS_RATE_LIMIT_DELAY_MS 1000

// Response caching
#define CACHE_TTL_SECONDS 3600  // 1 hour
```

## ðŸ“ˆ Usage Examples

### Basic Vulnerability Scoring

```c
#include "ai-engine/scoring/vulnerability_scoring.h"

// Initialize scoring system
vulnerability_scoring_init();

// Get comprehensive score for a CVE
vulnerability_score_t *score = get_comprehensive_score("CVE-2023-12345");

if (score) {
    printf("CVE: %s\n", score->cve_id);
    
    if (score->cvss_v3_1) {
        printf("CVSS v3.1: %.1f (%s)\n", 
               score->cvss_v3_1->base_score,
               cvss_severity_to_string(score->cvss_v3_1->severity));
    }
    
    if (score->kev) {
        printf("KEV Status: %s\n", score->kev->is_kev ? "Yes" : "No");
    }
    
    if (score->epss) {
        printf("EPSS Score: %.5f (%.1f%%)\n", 
               score->epss->score, score->epss->percentile);
    }
    
    printf("AI Risk Score: %.1f/10.0\n", score->ai_risk_score);
    printf("AI Priority: %s\n", score->ai_priority);
    printf("Remediation Urgency: %s\n", score->ai_remediation_urgency);
    
    vulnerability_score_free(score);
}

vulnerability_scoring_cleanup();
```

### Batch Processing

```c
// Process multiple CVEs
GPtrArray *cve_list = g_ptr_array_new_with_free_func(g_free);
g_ptr_array_add(cve_list, g_strdup("CVE-2023-12345"));
g_ptr_array_add(cve_list, g_strdup("CVE-2023-23456"));

// Update all scores
update_vulnerability_scores(cve_list);

g_ptr_array_free(cve_list, TRUE);
```

### Filtering and Sorting

```c
GPtrArray *all_scores = /* ... get vulnerability scores ... */;

// Filter by severity
GPtrArray *critical_vulns = filter_vulnerabilities_by_severity(
    all_scores, CVSS_SEVERITY_CRITICAL);

// Filter KEV vulnerabilities
GPtrArray *kev_vulns = filter_vulnerabilities_by_kev(all_scores, TRUE);

// Sort by AI risk score
g_ptr_array_sort(all_scores, vulnerability_score_compare_ai_risk);

// Get top 10 vulnerabilities
JsonArray *top_vulns = get_top_vulnerabilities(all_scores, 10);
```

## ðŸŽ¨ GUI Integration

The web GUI displays comprehensive scoring information:

### CVSS Scores Display
```html
<div class="cvss-scores">
    <div class="score-item">
        <label>CVSS v3.1:</label>
        <span class="score-value">9.1</span>
        <span class="score-severity critical">Critical</span>
    </div>
</div>
```

### Risk Assessment Panel
```html
<div class="risk-scores">
    <div class="score-item">
        <label>KEV Status:</label>
        <span class="kev-status no">No</span>
    </div>
    <div class="score-item">
        <label>EPSS Score:</label>
        <span class="epss-score">0.00052</span>
        <span class="epss-percentile">(5.2%)</span>
    </div>
</div>
```

### AI-Enhanced Analysis
```html
<div class="ai-scores">
    <div class="score-item">
        <label>AI Risk Score:</label>
        <span class="ai-risk-score">8.7</span>
        <span class="score-scale">/10.0</span>
    </div>
</div>
```

## ðŸ”§ Configuration

### Environment Variables
```bash
# API endpoints
export NVD_API_KEY="your-nvd-api-key"
export EPSS_API_ENDPOINT="https://api.first.org/data/v1/epss"

# Rate limiting
export NVD_RATE_LIMIT_MS=6000
export EPSS_RATE_LIMIT_MS=1000

# Caching
export VULN_CACHE_TTL=3600
export VULN_CACHE_SIZE=10000
```

### Configuration File
```ini
[vulnerability_scoring]
enabled = true
cache_enabled = true
cache_ttl = 3600

[external_sources]
nvd_enabled = true
kev_enabled = true
epss_enabled = true
ssvc_enabled = true

[ai_enhancement]
composite_scoring = true
priority_determination = true
remediation_urgency = true
```

## ðŸ“Š Scoring Interpretation Guide

### When Scores Don't Align

| Scenario | CVSS | KEV | EPSS | SSVC | AI Decision | Reasoning |
|----------|------|-----|------|------|-------------|-----------|
| High impact, low exploitation | 9.1 | No | 0.0005 | Attend | HIGH | Critical systems need protection regardless of exploit probability |
| Medium impact, active exploitation | 6.5 | Yes | 0.8 | Act | CRITICAL | Active exploitation overrides moderate CVSS |
| High CVSS, high EPSS | 8.2 | No | 0.15 | Act | CRITICAL | High likelihood of exploitation |
| Low CVSS, KEV listed | 4.5 | Yes | 0.05 | Act | CRITICAL | Confirmed exploitation in wild |

### Priority Matrix

| CVSS Severity | KEV Status | EPSS Range | Final Priority |
|---------------|------------|------------|----------------|
| Critical      | Yes        | Any        | CRITICAL       |
| High          | Yes        | Any        | CRITICAL       |
| Any           | Yes        | Any        | CRITICAL       |
| Critical      | No         | >0.1       | CRITICAL       |
| Critical      | No         | <0.1       | HIGH           |
| High          | No         | >0.1       | HIGH           |
| High          | No         | <0.1       | MEDIUM         |
| Medium        | No         | >0.1       | MEDIUM         |
| Medium        | No         | <0.1       | LOW            |

## ðŸ§ª Testing

### Unit Tests
```bash
cd build
./tests/test_vulnerability_scoring
```

### Integration Tests
```bash
# Test with real API endpoints
export NVD_API_KEY="your-key"
./tests/test_external_data_sources
```

### Performance Tests
```bash
# Benchmark scoring performance
./tests/benchmark_vulnerability_scoring
```

## ðŸ”’ Security Considerations

### API Key Management
- Store API keys securely using environment variables
- Rotate keys regularly
- Monitor API usage and costs

### Rate Limiting
- Respect API provider rate limits
- Implement exponential backoff for failures
- Cache responses to minimize API calls

### Data Validation
- Validate all external API responses
- Sanitize input data before processing
- Handle malformed or missing data gracefully

## ðŸ“ž Support

For questions about vulnerability scoring:
- **Documentation**: [Vulnerability Scoring Guide](docs/VULNERABILITY_SCORING.md)
- **API Reference**: [Scoring API Documentation](docs/api/scoring.md)
- **Issues**: [GitHub Issues](https://github.com/yourusername/ai-enhanced-openvas/issues)

---

**ðŸŽ¯ The comprehensive vulnerability scoring system provides the foundation for intelligent, context-aware vulnerability management that goes far beyond traditional CVSS scoring.**